# Tutorial 3: Producing Mutational Scanning Predictions for IDRs

## Overview

This step of the tutorial is intended to guide users on how to make
specific predictions about how mutations will impact an IDR. Users will
need a pretrained weights file (e.g. from Tutorial 1), and can specify
any given IDR of interest by giving the name of a fasta file and a 
sequence. The model will output, for the features it considers most
distinct for the input IDR, two mutational scanning maps for each feature,
showing how point mutations in the input IDR change the feature of interest
(see the paper for a more comprehensive explanation.)

**NOTE:** Currently this tutorial can only be run if you have a tensorflow-enabled
GPU - unfortunately, one of the steps in the architecture has a channel
order that will only work on GPU :(

### Options for analyzing output
We provide a local webapp to visualize and interact with the outputs
of this model. **We recommend using this webapp, which requires additional
Python packages listed in webapp_requirements.txt, and must be run on a 
device with a monitor.** Our webapp allows for greater interactivity: 
you can select features through a dropdown list, zoom in on heat map and letter
map outputs, and see point mutations in detail by hovering over cells in
the heat map. 

Alternatively, the code can directly output predictions as png files in
a directory of your choice. 

**To toggle between these options, edit line 27 
in save_mutational_scanning.py in the /visualization subdirectory:**
> save_webapp = True

## Step 1: Configure options 
Open the create_mutational_scanning.py file in a text editor or an IDE.
Configure the following options:
- **save_webapp (line 27)**: Whether to output results as readable for
the local webapp code (True) or directly as png images (False).
- **input_fasta (line 29)**: Fasta file containing the sequence you
want to run mutational scanning for.
- **remove_M (line 30)**: If your sequence is at the N-terminal and
starts with M, set this to True (this will make the model ignore the
start codon).
- **species (line 31)**: Which species to use from the input fasta file
(this will look for a sequence with an identifier matching species as
a subsequence and should uniquely identify a single sequence in the file.)
- **start, end (lines 32, 33)**: Start and end of the IDR in the protein
(if you don't know this, just set start to 0 and end to the length of
the IDR - this is just to help visualization by labeling the amino acids
with positions.)
- **weight_path (line 35)**: Weights to load pretrained model from
- **outdir (line 36)**: Where to save model

In addition, you may want to configure the following advanced options:
- **autoselect_filters (line 38)**: By default, the script will 
automatically decide which features to output. You can override this 
behavior and manually select features by setting this to "False"
- **minimum_significant (line 39)**: By default (if autoselect_filters 
is False), the model will either select features greater than 3 in z-score
relative to the reference set of IDRs, or if there are fewer than the 
number set in "minimum_significant", the top ranked features up to this
number.
- **filters_of_interest (line 40)**: If autoselect_filters is False,
you can directly specify which features you want to use here by index.
Note that average features are indiced as their filter number + 256 (so
Average Feature 0 is 256, 1 is 257, etc...)
- **z_score_file (line 41)**: What reference file of features to use
as the basis for selecting significant features from. We've pointed it
to the features for the entire IDRnome.

## Step 2: Run mutational scanning
Simply run:
> python create_mutational_scanning.py

This will output mutational scanning maps to your output directory.

## Step 3: Analyze output
If you set save_webapp to False, you will get a directory of png images
corresponding to letter and heat maps for significant features. The 
z-scores (corresponding to how high the feature activations of these
features are compared to the reference IDRnome) for each feature can be
found in the zscores.txt file in the directory.

Otherwise, you can load the directory into the webapp code in
the create_website.py script in mutational_scanning_webapp directory.

1. Open the create_website.py file in a text editor or IDR, and modify
the idrpath variable (line 15) to point to the directory generated by
step 2. 
2. Run: 
> python create_website.py
3. The code will automatically boot a webpage (this can only
be accessed on your local machine), that you can navigate to by 
accessing the IP address given to you by the system print output 
in your web-browser. 


